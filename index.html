<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sentinel-X IDE</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: #1e1e1e;
    color: #f5f5f5;
  }

  header {
    background: #0d1117;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #333;
  }

  header h1 {
    margin: 0;
    font-size: 1.2rem;
  }

  .button-group {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  header button, header select {
    background: #0a84ff;
    border: none;
    padding: 8px 12px;
    color: white;
    cursor: pointer;
    border-radius: 4px;
    font-weight: bold;
    transition: 0.2s;
  }

  header button:hover {
    background: #006edc;
  }

  header select {
    background: #2c2c2c;
    border: 1px solid #444;
    color: #fff;
    font-weight: bold;
  }

  main {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .editor {
    width: 50%;
    display: flex;
    flex-direction: column;
    border-right: 1px solid #333;
    background: #1e1e1e;
  }

  .tabs {
    display: flex;
    background: #2c2c2c;
    border-bottom: 1px solid #333;
  }

  .tabs button {
    flex: 1;
    background: #2c2c2c;
    border: none;
    padding: 10px;
    color: #f5f5f5;
    cursor: pointer;
    font-weight: bold;
  }

  .tabs button.active {
    background: #0a84ff;
  }

  textarea {
    flex: 1;
    background: #1e1e1e;
    color: #f5f5f5;
    border: none;
    resize: none;
    font-family: 'Courier New', Courier, monospace;
    font-size: 14px;
    padding: 10px;
    outline: none;
    line-height: 1.4;
  }

  .preview {
    flex: 1;
    background: white;
    border-left: 1px solid #333;
    position: relative;
  }

  iframe {
    width: 100%;
    height: 100%;
    border: none;
    pointer-events: auto;
  }
</style>
</head>
<body>
<header>
  <h1>Sentinel-X IDE</h1>
  <div class="button-group">
    <select id="exampleSelect">
      <option value="">ðŸ“‚ Load Example</option>
      <option value="examples/blog layout">Blog Layout</option>
      <option value="examples/business homepage">Business Homepage</option>
      <option value="examples/contact form">Contact Form</option>
      <option value="examples/event invitation">Event Invitation</option>
      <option value="examples/portfolio gallery">Portfolio Gallery</option>
      <option value="examples/profile card">Profile Card</option>
      <option value="examples/responsive navigation bar">Responsive Navigation Bar</option>
      <option value="examples/simple landing page">Simple Landing Page</option>
      <option value="examples/starter page">Starter Page</option>
      <option value="examples/student dashboard">Student Dashboard</option>
    </select>
    <button id="runBtn">Run</button>
    <button id="stopBtn">Stop</button>
    <button id="saveBtn">Save</button>
    <button id="submitBtn">Submit Code</button>
  </div>
</header>

<main>
  <div class="editor">
    <div class="tabs">
      <button id="htmljsTab" class="active">HTML & JS</button>
      <button id="cssTab">CSS</button>
    </div>
    <textarea id="codeArea" placeholder="Write your code here..."></textarea>
  </div>
  <div class="preview">
    <iframe id="previewFrame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
  </div>
</main>

<script>
const codeArea = document.getElementById('codeArea');
const previewFrame = document.getElementById('previewFrame');
const saveBtn = document.getElementById('saveBtn');
const submitBtn = document.getElementById('submitBtn');
const runBtn = document.getElementById('runBtn');
const stopBtn = document.getElementById('stopBtn');
const htmljsTab = document.getElementById('htmljsTab');
const cssTab = document.getElementById('cssTab');
const exampleSelect = document.getElementById('exampleSelect');

let activeTab = 'htmljs';
const code = {
  htmljs: "<h1>Hello World</h1>\n<p>Welcome to Sentinel-X IDE!</p>\n<script>console.log('Hello from JS!');<\/script>",
  css: "body { font-family: Arial; background:#f0f0f0; color:#333; padding:20px; }"
};

let currentIframeWindow = null; // session state management

// Initialize editor
codeArea.value = code[activeTab];

// Switch tabs
function switchTab(tab) {
  activeTab = tab;
  htmljsTab.classList.remove('active');
  cssTab.classList.remove('active');
  document.getElementById(tab + 'Tab').classList.add('active');
  codeArea.value = code[activeTab];
}
htmljsTab.addEventListener('click', () => switchTab('htmljs'));
cssTab.addEventListener('click', () => switchTab('css'));

// Auto indentation
codeArea.addEventListener("keydown", function(e) {
  if (e.key === "Tab") {
    e.preventDefault();
    const start = this.selectionStart;
    const end = this.selectionEnd;
    const indent = "  ";
    this.value = this.value.substring(0, start) + indent + this.value.substring(end);
    this.selectionStart = this.selectionEnd = start + indent.length;
  }
  if (e.key === "Enter") {
    const start = this.selectionStart;
    const lineStart = this.value.lastIndexOf("\n", start - 1) + 1;
    const currentLine = this.value.substring(lineStart, start);
    const match = currentLine.match(/^\s+/);
    if (match) {
      e.preventDefault();
      const indent = match[0];
      const before = this.value.substring(0, start);
      const after = this.value.substring(this.selectionEnd);
      this.value = before + "\n" + indent + after;
      this.selectionStart = this.selectionEnd = start + 1 + indent.length;
    }
  }
});

// Update preview function
function updatePreview() {
  const content = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>Preview</title>
      <base target="_self">
      <style>${code.css}</style>
    </head>
    <body>
      ${code.htmljs}
    </body>
    </html>
  `;
  previewFrame.srcdoc = content;
  currentIframeWindow = previewFrame.contentWindow;
}

// Run button
runBtn.addEventListener('click', () => {
  updatePreview();
  previewFrame.focus();
});

// Stop button: resets the iframe
stopBtn.addEventListener('click', () => {
  previewFrame.srcdoc = "<!DOCTYPE html><html><body></body></html>";
  currentIframeWindow = null;
});

// Load example
exampleSelect.addEventListener('change', async () => {
  const folder = exampleSelect.value;
  if (!folder) return;

  try {
    const [htmlResp, cssResp] = await Promise.all([
      fetch(`${folder}/index.html`),
      fetch(`${folder}/style.css`)
    ]);

    if (!htmlResp.ok || !cssResp.ok) throw new Error("Failed to fetch files");

    code.htmljs = await htmlResp.text();
    code.css = await cssResp.text();
    codeArea.value = code[activeTab];

    runBtn.click(); // Automatically run after loading example

    alert(`âœ… Loaded example: ${folder.split('/').pop()}`);
  } catch (err) {
    alert("âŒ Failed to load example. Run the IDE on localhost using python -m http.server");
    console.error(err);
  }
});

// Save full HTML
saveBtn.addEventListener('click', () => {
  const blob = new Blob([`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>My Page</title>
      <style>${code.css}</style>
    </head>
    <body>
      ${code.htmljs}
    </body>
    </html>
  `], { type: 'text/html' });

  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'index.html';
  link.click();
});

// Submit code to email (FormSubmit)
submitBtn.addEventListener('click', () => {
  const form = document.createElement('form');
  form.action = "https://formsubmit.co/sentinelxide@gmail.com";
  form.method = "POST";
  form.style.display = "none";

  const htmlInput = document.createElement('textarea');
  htmlInput.name = "htmljs_code";
  htmlInput.value = code.htmljs;

  const cssInput = document.createElement('textarea');
  cssInput.name = "css_code";
  cssInput.value = code.css;

  const nameInput = document.createElement('input');
  nameInput.type = "hidden";
  nameInput.name = "_subject";
  nameInput.value = "New Code Submission from Sentinel-X IDE";

  const redirect = document.createElement('input');
  redirect.type = "hidden";
  redirect.name = "_next";
  redirect.value = window.location.href;

  form.appendChild(htmlInput);
  form.appendChild(cssInput);
  form.appendChild(nameInput);
  form.appendChild(redirect);
  document.body.appendChild(form);
  form.submit();
});

// Initialize preview at load
updatePreview();
</script>
</body>
</html>
